<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Parking Search</title>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!--&lt;!&ndash; Latest compiled and minified CSS &ndash;&gt;-->
    <!--<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">-->

    <!--&lt;!&ndash; Optional theme &ndash;&gt;-->
    <!--<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">-->

    <!--&lt;!&ndash; Latest compiled and minified JavaScript &ndash;&gt;-->
    <!--<script src="//netdna.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>-->

    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>

<div id="map" style="width: 1345px; height: 660px"></div>

<script type="text/javascript">
    ymaps.ready(init);
    var myMap, parking;

    function init() {

        //open a map based on your location
    ymaps.geolocation.get().then(function (res) {
        var mapContainer = $('#map'),
            bounds = res.geoObjects.get(0).properties.get('boundedBy'),
            // Рассчитываем видимую область для текущей положения пользователя.
            mapState = ymaps.util.bounds.getCenterAndZoom(
                bounds,
                [mapContainer.width(), mapContainer.height()]
            );
        createMap(mapState);
    }, function (e) {
        // Если местоположение невозможно получить, то просто создаем карту.
        createMap({
            center: [55.751574, 37.573856],
            zoom: 2
        });
    });

    function createMap (state) {
        myMap = new ymaps.Map('map', state,{
            searchControlProvider: 'yandex#search'
        });
    }
        
        Park = new ymaps.GeoObjectCollection({}, {
            preset: 'island#redIcon'
        });
        var coord = []
        {% for i in data%}
        var temp = []
        temp.push({{ i.latitude }}, {{ i.longitude }})
        coord.push(temp)
        {% endfor %}

        for (var i = 0; i < coord.length; i++) {
            Park.add(new ymaps.Placemark(coord[i], {
                balloonContentHeader: "Назва парковки",
                balloonContentBody:
                '<div class="container">' +
                    '<div class="price">' +
                        '<span>Цена</span>' +
                        '<span>20грн</span>' +
                    '</div>' +
                    '<div class="telephone">' +
                        '<span>Телефон</span>' +
                        '<span>0956266849</span>' +
                    '</div>' +
                    '<div class="places">' +
                        '<span>Місць</span>' +
                        '<span>20</span>' +
                    '</div>' +
                    '<div class="email">' +
                        '<span>Пошта</span>' +
                        '<span>Example@gmail.com</span>' +
                    '</div>' +
                '</div>'

            },{
                preset: "islands#redStretchyIcon",
                balloonCloseButton: true,
                hideIconOnBalloonOpen: false
            }));
        }


        //get browser myLocation
        ymaps.geolocation.get({
            provider: 'browser',
            mapStateAutoApply: true
        }).then(function (result) {
        // Синим цветом пометим положение, полученное через браузер.
            result.geoObjects.options.set('preset', 'islands#blueCircleIcon');
            myMap.controls
                .add('zoomControl', { position: { left: 160, top: 50 } });
            myMap.geoObjects.add(result.geoObjects); //add mylocation
            myMap.geoObjects.add(Park); //add parkings
        });

    }

</script>

</body>
</html>